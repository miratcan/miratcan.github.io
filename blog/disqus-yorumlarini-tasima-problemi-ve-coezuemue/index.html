<!DOCTYPE html>
<html>
<head>
  <style type="text/css">

    body {
      max-width: 40em;
      padding: 1em;
      margin: 1em auto;
    }

    pre {
      font-family: inherit;
      color: inherit;
      background: lightgrey;
      padding: 1em;
      overflow: auto;
    }

    ul.nav {
      list-style-type: none;
      overflow: auto;
      padding: 0;
    }

    ul.nav li {
      float: left;
      margin: 0 20px 0 0;
    }

    img {
      max-width: 100%;
    }
    li {
      margin-bottom: 0.25em;
    }
    span.date {
      font-size: 0.7em;
      float: right;
    }
    table {
      width: 100%;
    }
    th, td {
      border-bottom: 1px solid grey;
      padding: 0.25em;
      text-align: left;
    }
    img {
      left: 0;
      right: 0;
      margin-right: auto;
      margin-left: auto;
    }   

  </style>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Disqus Yorumlarını Taşıma Problemi ve Çözümü — Mirat Can Bayrak</title>
</head>
<body>
<ul class="nav">
  <li>
    <a href="../../">Anasayfa</a></li>
    
      <li class="active">
        <a href="../../blog/">Blog</a>
      </li>
    
      <li>
        <a href="../../projeler/">Projeler</a>
      </li>
    
</ul>

  
  <h1>Disqus Yorumlarını Taşıma Problemi ve Çözümü</h1>
  <p>Kişisel blogumu Tumblr'dan taşımak istedim. Taşımak isteme sebebim Lektor oldu. <a href="https://www.getlektor.com/">Lektor</a> Markdown tabanlı bir statik web sitesi jeneratörü bu yazının konusu olmayan bir çok güzel özelliği var. Yeni siteye eski blogdan yazıları taşıdıktan sonra Disqus'daki yorumları yeni domaine ve yazı adreslemelerine taşımam gerekti. Sadece domain değiştiğinde yani taşınma şemamız aşağıdaki gibiyse sadece domaini değiştirerek taşınma işini halledebiliyoruz:</p>
<table>
<thead><tr>
<th>Eski Adres</th>
<th>Yeni Adres </th>
</tr>
</thead>
<tbody>
<tr>
<td>site1.com/adres1/</td>
<td>site2.com/adres1/</td>
</tr>
<tr>
<td>site1.com/adres2/</td>
<td>site2.com/adres2/</td>
</tr>
</tbody>
</table>
<p>Ancak benim taşınma şemam bu kadar basit değildi, hem domain değişiyor hem de her yazının adresi de değişiyordu:</p>
<table>
<thead><tr>
<th>Eski Adres</th>
<th>Yeni Adres </th>
</tr>
</thead>
<tbody>
<tr>
<td>site1.com/adres1/</td>
<td>site2.com/adres2/</td>
</tr>
<tr>
<td>site1.com/adres3/</td>
<td>site2.com/adres4/</td>
</tr>
</tbody>
</table>
<p>Bu durumda Disqus, blogda şimdiye kadar Disqus penceresi en az bir defa render edilmiş gönderilerin olduğu bir CSV dosyası veriyor, CSV dosyanın içerisinde her adresin karşılığına hangi adresin geldiğini yazıp tekrar upload etmemizi istiyor. İşlemin nasıl yapılacağı ile ilgili ayrıntılı bilgi şurada: <a href="https://help.disqus.com/customer/portal/articles/286778-migration-tools">https://help.disqus.com/customer/portal/articles/286778-migration-tools</a></p>
<p>Buraya kadar her şey mantıklı, CSV dosyası indireceğiz, her adresin karşısına yeni adresi yazacağız ve geri upload edeceğiz. Ancak CSV dosyasını incelediğimde değişmeye başladı. Aşağıda elime geçen CSV dosyasından bir kesit var:</p>
<table>
<thead><tr>
<th>Adres</th>
</tr>
</thead>
<tbody>
<tr>
<td> <a href="http://miratcan.tumblr.com/post/14315717349">http://miratcan.tumblr.com/post/14315717349</a></td>
</tr>
<tr>
<td> <a href="http://miratcan.tumblr.com/post/16236379665">http://miratcan.tumblr.com/post/16236379665</a></td>
</tr>
<tr>
<td> <a href="http://miratcan.tumblr.com/post/16422262730">http://miratcan.tumblr.com/post/16422262730</a></td>
</tr>
<tr>
<td> <a href="http://miratcan.tumblr.com/post/14315714972">http://miratcan.tumblr.com/post/14315714972</a></td>
</tr>
<tr>
<td> <a href="http://miratcan.tumblr.com/post/16597868308">http://miratcan.tumblr.com/post/16597868308</a></td>
</tr>
</tbody>
</table>
<p>Bağlantılara tek tek tıklayıp kontrol ettiğimde 404 veren sayfalar olduğunu gördüm. Disqus benim sildiğim, artık 404 veren sayfaları ayıklamamış, öte yandan asılnda hiç yorum olmayan sayfaların linklerini de benim CSV dosyama eklemiş. Elimde 575 satırlık satırlık eminim çoğu çöp olan bir adres listesi var. Açıkcası bu noktada biraz Disqus kullandığıma pişman oldum. Zira bu listeyi ya elle ya da çeşitli scriptlerle temizlemem gerekiyordu.</p>
<p>Bu problemi çözen bir script yazdım. CSV dosyasını parametre olarak alıyor ve filtreleyip geri veriyor. Benim 575 satırlık devasa listeyi 12 elemana düşürdü. Şuradan indirip kullanabilirsiniz:</p>
<p><a href="https://gist.github.com/miratcan/c2b486945798c70b35c1adc7f70b70db">https://gist.github.com/miratcan/c2b486945798c70b35c1adc7f70b70db</a></p>

  <hr />
  <p>Mirat - October 2016</p>

</body>
</html>


