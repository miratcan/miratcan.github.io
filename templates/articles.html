{% extends "layout.html" %}
{% from "macros/pagination.html" import render_pagination %}
{% block title %}{{ this.title }}{% endblock %}
{% block body %}
<h1>Articles</h1>
<div class="articles-layout">
  <main class="articles-main">
    {% with posts=this.pagination.items %}{% include "_articles.html" %}{% endwith %}
    {{ render_pagination(this.pagination) }}
  </main>
  <aside class="articles-sidebar">
    {% with tags=this.children.distinct('tags') %}
    {% include "_tags.html" %}
    {% endwith %}
  </aside>
</div>
{% endblock %}
{% block after_screen %}
<script>
(function() {
  var links = document.querySelectorAll('.lang-filter a[data-lang]');
  var items = document.querySelectorAll('#articles li[data-language]');

  var tagLinks = document.querySelectorAll('.tag-list a');

  function updateTagLinks(lang) {
    var suffix = (lang && lang !== 'all') ? '#lang=' + lang : '';
    tagLinks.forEach(function(a) {
      var base = a.href.split('#')[0];
      a.href = base + suffix;
    });
  }

  function filterByLang(lang) {
    items.forEach(function(item) {
      if (lang === 'all' || item.getAttribute('data-language') === lang) {
        item.style.display = '';
      } else {
        item.style.display = 'none';
      }
    });
    links.forEach(function(link) {
      if (link.getAttribute('data-lang') === lang) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
    updateTagLinks(lang);
  }

  links.forEach(function(link) {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      var lang = this.getAttribute('data-lang');
      filterByLang(lang);
      history.replaceState(null, '', lang === 'all' ? location.pathname : '#lang=' + lang);
    });
  });

  var hash = location.hash;
  if (hash && hash.indexOf('#lang=') === 0) {
    filterByLang(hash.replace('#lang=', ''));
  }
})();
</script>
{% endblock %}
